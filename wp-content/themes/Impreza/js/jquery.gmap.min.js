/**
 * jQuery gMap - Google Maps API V3
 *
 * @license MIT License; http://www.opensource.org/licenses/mit-license.php
 * @url   http://github.com/marioestrada/jQuery-gMap
 * @author  Mario Estrada <me@mario.ec> based on original plugin by Cedric Kastner <cedric@nur-text.de>
 * @version 2.1.5
 */
/* global google */
(function(e){e.fn.gMap=function(t,n){switch(t){case"addMarker":return e(this).trigger("gMap.addMarker",[n.latitude,n.longitude,n.content,n.icon,n.popup]);case"centerAt":return e(this).trigger("gMap.centerAt",[n.latitude,n.longitude,n.zoom]);case"clearMarkers":return e(this).trigger("gMap.clearMarkers")}var r=e.extend({},e.fn.gMap.defaults,t);return this.each(function(){var t=new google.maps.Map(this);e(this).data("gMap.reference",t);var n=new google.maps.Geocoder;if(r.address){n.geocode({address:r.address},function(e,n){if(e&&e.length){t.setCenter(e[0].geometry.location)}})}else{if(r.latitude&&r.longitude){t.setCenter(new google.maps.LatLng(r.latitude,r.longitude))}else{if(e.isArray(r.markers)&&r.markers.length>0){if(r.markers[0].address){n.geocode({address:r.markers[0].address},function(e,n){if(e&&e.length>0){t.setCenter(e[0].geometry.location)}})}else{t.setCenter(new google.maps.LatLng(r.markers[0].latitude,r.markers[0].longitude))}}else{t.setCenter(new google.maps.LatLng(34.885931,9.84375))}}}t.setZoom(r.zoom);t.setMapTypeId(google.maps.MapTypeId[r.maptype]);var i={scrollwheel:r.scrollwheel,disableDoubleClickZoom:!r.doubleclickzoom};if(r.controls===false){e.extend(i,{disableDefaultUI:true})}else if(r.controls.length!==0){e.extend(i,r.controls,{disableDefaultUI:true})}t.setOptions(i);var s=new google.maps.Marker;var o;var u;o=new google.maps.MarkerImage(r.icon.image);o.size=new google.maps.Size(r.icon.iconsize[0],r.icon.iconsize[1]);o.anchor=new google.maps.Point(r.icon.iconanchor[0],r.icon.iconanchor[1]);s.setIcon(o);if(r.icon.shadow){u=new google.maps.MarkerImage(r.icon.shadow);u.size=new google.maps.Size(r.icon.shadowsize[0],r.icon.shadowsize[1]);u.anchor=new google.maps.Point(r.icon.shadowanchor[0],r.icon.shadowanchor[1]);s.setShadow(u)}e(this).bind("gMap.centerAt",function(e,n,r,i){if(i){t.setZoom(i)}t.panTo(new google.maps.LatLng(parseFloat(n),parseFloat(r)))});var a=[],f=[];e(this).data("gMap.overlays",a);e(this).data("gMap.infoWindows",f);e(this).bind("gMap.clearMarkers",function(){while(a[0]){a.pop().setMap(null)}});var l;e(this).bind("gMap.addMarker",function(e,n,i,o,u,c){var h;var p;var d=new google.maps.LatLng(parseFloat(n),parseFloat(i));var v=new google.maps.Marker({position:d});if(u){h=new google.maps.MarkerImage(u.image);h.size=new google.maps.Size(u.iconsize[0],u.iconsize[1]);h.anchor=new google.maps.Point(u.iconanchor[0],u.iconanchor[1]);v.setIcon(h);if(u.shadow){p=new google.maps.MarkerImage(u.shadow);p.size=new google.maps.Size(u.shadowsize[0],u.shadowsize[1]);p.anchor=new google.maps.Point(u.shadowanchor[0],u.shadowanchor[1]);s.setShadow(p)}}else{v.setIcon(s.getIcon());v.setShadow(s.getShadow())}if(o){if(o==="_latlng"){o=n+", "+i}var m=new google.maps.InfoWindow({content:r.html_prepend+o+r.html_append});google.maps.event.addListener(v,"click",function(){if(l){l.close()}m.open(t,v);l=m});if(c){google.maps.event.addListenerOnce(t,"tilesloaded",function(){m.open(t,v)})}f.push(m)}v.setMap(t);a.push(v)});var c;var h=this;var p=function(t){return function(n,r){if(n&&n.length>0){e(h).trigger("gMap.addMarker",[n[0].geometry.location.lat(),n[0].geometry.location.lng(),t.html,t.icon,t.popup])}}};for(var d=0;d<r.markers.length;d++){c=r.markers[d];if(c.address){if(c.html==="_address"){c.html=c.address}n.geocode({address:c.address},p(c))}else{e(this).trigger("gMap.addMarker",[c.latitude,c.longitude,c.html,c.icon,c.popup])}}})};e.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:false,doubleclickzoom:true,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery)
